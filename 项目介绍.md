# 叙事导航者：基于动态事件图谱的回忆录访谈规划系统

---

# 一、总体项目介绍

## 1.1 项目愿景：用科技留存岁月

### 核心特性

**实时交互**：
- 访谈的及时回应对话
- 规划人生主线的引导 Planner
- User Simulator 测试
- 切换话题还是追问细节判断节点
- 语音输入的口音识别

**多模态**：
- 视觉引导：上传照片
- 多图叙事链条

**实时产出**：
- 生成大事件脉络
- 全部基于用户访谈，没有幻觉

**叙事风格**：
- 个人风格
- 名家风格
- 回忆录风格

**评估体系**：
- 保真、完整（召回）
- 提问技巧、覆盖度、信息获取密度

---

## 1.2 项目概述

在长程回忆录访谈中，通用大语言模型常面临以下痛点：

| 痛点 | 描述 |
|:---|:---|
| **遗忘主线** | 缺乏全局规划，容易偏离访谈目标 |
| **提问浅尝辄止** | 缺乏深度挖掘机制，无法获取细节 |
| **逻辑跳跃** | 话题切换生硬，缺乏连贯性 |

### 项目目标

本项目旨在研发一个独立的**访谈决策规划模块（Planner）**，与负责自然语言生成的交互模块解耦。

**Planner 模块的核心任务**：

1. 构建并维护一个动态的个人人生事件树（或图谱）
2. 实时从用户回答中抽取关键事件节点
3. 将事件结构化地挂载到预设的"人生阶段大纲"上
4. 基于图谱状态决定下一步访谈动作：
   - **深挖（Depth-expansion）**：针对当前事件追问细节、情感与反思
   - **跳转（Breadth-switching）**：开启新的人生阶段
5. 确保访谈覆盖完整人生阶段，同时智能识别并挖掘高价值记忆亮点

---

## 1.3 预期成果

### 1. 规划器算法模块（Python）

随着访谈进行，通过输入对话历史，输出结构化的访谈决策指令（多个关键 field，多层次），而非直接输出对话文本。

### 2. 动态事件图谱可视化工具

能够实时展示访谈过程中构建的"人生事件树/图"，清晰呈现：
- 已挖掘的事件
- 待挖掘的节点
- 访谈的覆盖率

### 3. 仿真评估环境与报告

构建由 LLM 扮演的"模拟受访者（User Simulator）"，进行自动化多轮访谈测试。

**对比评估指标**：
- 话题覆盖率（Recall）
- 对话深度（Average Turn Depth）
- 逻辑连贯性

---

# 二、整体架构设计

## 2.1 系统分层

```
┌─────────────────────────────────────────────────────────────┐
│                    用户交互层 (Phase 1)                       │
│              Interview Dashboard + Cytoscape.js              │
├─────────────────────────────────────────────────────────────┤
│                    核心规划层 (Phase 2)                       │
│  Dialogue Manager | Event Extractor | Graph Builder | Nav   │
├─────────────────────────────────────────────────────────────┤
│                    评估测试层 (Phase 3)                       │
│              User Simulator | Metrics Calculator             │
└─────────────────────────────────────────────────────────────┘
```

## 2.2 架构图

```
graph TB
    subgraph "用户交互层 User Interface Layer"
        A[访谈界面<br/>Interview Dashboard<br/>Dash Web App]
        B[可视化组件<br/>Graph Visualization<br/>Cytoscape.js]
    end

    subgraph "核心规划层 Core Planner Module"
        C[对话管理器<br/>Dialogue Manager<br/>会话控制、状态管理]
        D[事件抽取器<br/>Event Extractor<br/>LLM-based NER + RE]
        E[图谱构建器<br/>Graph Builder<br/>NetworkX图操作]
        F[导航决策器<br/>Navigation Decider<br/>混合策略算法]
    end

    subgraph "数据存储层 Data Storage Layer"
        G[(事件图谱<br/>Event Knowledge Graph<br/>NetworkX + JSON)]
        H[(对话历史<br/>Dialogue History<br/>SQLite/JSON)]
    end

    subgraph "AI服务层 AI Service Layer"
        I[LLM API<br/>事件抽取<br/>Event Extraction]
        J[LLM API<br/>策略规划<br/>Strategy Planning]
        K[LLM API<br/>自然语言生成<br/>NLG]
    end

    subgraph "评估测试层 Evaluation Layer"
        L[用户模拟器<br/>User Simulator<br/>LLM-based Persona]
        M[评估指标<br/>Metrics Calculator<br/>Coverage/Depth/Coherence]
    end

    A --> C
    A <--> B
    C --> D
    C --> F
    D --> E
    E --> G
    F --> G
    F --> H

    D -.API调用.-> I
    F -.API调用.-> J
    C -.API调用.-> K

    L -.仿真对话.-> C
    C -.性能数据.-> M
    G -.图谱状态.-> B
```

## 2.3 信息数据流

```
sequenceDiagram
    participant U as 用户 User
    participant UI as 前端界面 Web UI
    participant DM as 对话管理器 Dialogue Manager
    participant EE as 事件抽取器 Event Extractor
    participant GB as 图谱构建器 Graph Builder
    participant ND as 导航决策器 Navigator
    participant LLM as LLM API
    participant VIS as 可视化组件 Visualization

    U->>UI: 输入回答
    UI->>DM: 提交用户输入
    DM->>EE: 请求事件抽取
    EE->>LLM: API调用 (事件抽取prompt)
    LLM-->>EE: 返回JSON格式事件
    EE->>GB: 传递提取的事件
    GB->>GB: 更新NetworkX图谱
    GB-->>DM: 返回更新后的图谱状态

    DM->>ND: 请求下一步决策
    ND->>ND: 计算覆盖率、深度等指标
    ND->>ND: 执行决策算法
    ND-->>DM: 返回动作类型 (DEPTH/BREADTH/SWITCH)

    DM->>LLM: API调用 (生成下一个问题)
    LLM-->>DM: 返回结构化问题
    DM->>VIS: 更新图谱可视化数据
    VIS-->>UI: 渲染更新后的图谱
    DM-->>UI: 返回下一个问题
    UI-->>U: 显示问题

    Note over U,VIS: 循环进行，直到访谈完成
```

---

# 三、Planner 核心算法

## 3.1 三个阶段的演变

### 第一阶段：骨架期

| 项目 | 内容 |
|:---|:---|
| **输入** | 极简的生平（出生地、职业、现居地） |
| **输出** | "待填空的生命树"，通用模板（童年-求学-工作-家庭-退休） |

### 第二阶段：生长蔓延期

**Planner 行为**：这是一个"边跑边织网"的过程

**动作逻辑**：
1. **捕捉**：识别用户回答中的"高亮实体"（人名、具体时间）
2. **挂载**：将实体挂载到骨架上
3. **预测**：如果用户提到"大哥"，Planner 自动在大纲中生成子任务——"后续需挖掘与大哥的关系"

### 第三阶段：主题升华期

| 项目 | 内容 |
|:---|:---|
| **触发条件** | 访谈接近尾声（覆盖率 > 70%） |
| **Planner 行为** | 切换到"总结模式" |
| **动作逻辑** | 扫描整个事件图谱，寻找高频情绪词（如：遗憾、奋斗、漂泊） |
| **结果** | 梳理出"主题"，如《漂泊中的安宁》 |

---

## 3.2 状态感知层：动态调整大纲

Planner 并不是直接看对话，而是通过一个语义转化器将对话实时映射到图谱状态中。

### 实体与关系提取 (ER Extraction)

从用户回答中剥离出：
- 人物
- 地点
- 时间
- 核心动作

> 参考：Second Me (https://arxiv.org/pdf/2503.08102)

### 槽位填充 (Slot Filling)

针对每个事件，建立一个"叙事完整度"度量衡。

**示例**：初恋节点可能包含的槽位：
- [ ] 人物特征
- [ ] 相识契机
- [ ] 情感冲突
- [ ] 最终结局

Planner 会检查哪些槽位是空的。

### 时序锚定 (Temporal Anchoring)

判断新信息是属于当前时间线，还是老人突发奇想的"闪回"。

---

## 3.3 价值评估层：决定在哪儿停留

Planner 需要对图谱中的节点进行权重计算：

| 评估维度 | 说明 |
|:---|:---|
| **情绪能量检测** (Emotional Energy) | 监测语气词、情感强度。情感波动大时标记为"高价值节点" |
| **信息密度** (Information Density) | 评估是否提供新细节，还是在重复旧话 |
| **叙事独特性** (Uniqueness) | 匹配时代背景库。特定历史时期的典型经历优先级调高 |
| **价值评分机制** (Pruning & Prioritization) | 根据用户回答的"情绪颗粒度"或"信息密度"为节点打分 |

---

## 3.4 策略决策层：导航算法

### A. 深度扩展 (Deep Dive)

**触发条件**：
- "核心事件"槽位未满
- "情绪能量"高

**引导阈值**：如果用户当前回答字数 < 30 字且没有实体，Planner 必须执行：
- Sensory_Prompt（感官诱导）
- Elaborate（细节追问）
- Reflect（引导反思情感）

#### 路径 A：由"事"及"人"（归纳法）

| 属性 | 描述 |
|:---|:---|
| **定位** | 最基础、最稳健的路径 |
| **动作** | 按照时间轴索要事实 |
| **演进** | 当事件足够多时，计算节点的关键词重合度 |
| **示例** | 老人提到 5 个事件都涉及"独自承担风险"，Planner 自动提炼出性格标签"孤勇" |
| **适用场景** | 访谈早期，建立信任和基础素材库 |

#### 路径 B：由"物"及"情"（感官触发法）

| 属性 | 描述 |
|:---|:---|
| **定位** | 针对老人对抽象时间模糊、对物品记忆深刻的特点 |
| **动作** | 主动抛出感官锚点（照片、老物件、老地名） |
| **演进** | 物品 → 关联事件 → 时代记忆 |
| **示例** | "您家里现在还留着当年的那枚军功章吗？" → 引发对授勋仪式的描述 |
| **适用场景** | 陷入僵局或老人出现"记忆疲劳"时 |

#### 路径 C：由"时代"及"个体"（演绎法）

| 属性 | 描述 |
|:---|:---|
| **定位** | 利用大模型知识库，将个人置于历史背景中 |
| **动作** | 调取时代背景库（如：90 年代下海潮） |
| **演进** | 时代趋势 → 询问老人在其中的位置 → 获得独特叙事 |
| **示例** | "1992 年南巡讲话后，很多人都辞职了，那时候您所在的单位有什么变化吗？" |
| **适用场景** | 提升回忆录的厚度，让个人史具备社会学价值 |

**深度判停 (Depth Stopper)**：

针对一个事件，如果 [时间、地点、人物、起因、结果、感受] 已经收集了 4 个以上，且用户情绪能量下降，Planner 必须执行 Breadth_Switch。

---

### B. 广度跳转 (Breadth Switching)

**触发条件**：
- 当前节点"信息密度"衰减
- 出现"话题疲劳"（老人回答变简短）

**跳转概率公式**：

$$Switch\_Probability = \alpha \cdot (1 - \text{Current\_Information\_Density}) + \beta \cdot \text{User\_Fatigue\_Score}$$

#### 路径 1：物理/地理跳转 (Spatial Jumping)

| 属性 | 描述 |
|:---|:---|
| **策略** | 从当前地点延伸到下一个地点 |
| **示例** | "您刚才提到在上海厂里工作的事，后来我看您档案里还去过西安，那次跨越大半个中国的搬家是怎么发生的？" |
| **产品逻辑** | 人的记忆往往和物理空间绑定（家、学校、工厂） |

#### 路径 2：人物社交网络跳转 (Social Network Jumping)

| 属性 | 描述 |
|:---|:---|
| **策略** | 利用图谱中已识别但未展开的人物 |
| **示例** | "刚才您聊奋斗史的时候多次提到了您的爱人，咱们聊了很久您的工作，还没听您讲讲您和她最初是怎么认识的？" |
| **产品逻辑** | 带有"情感钩子"，老人乐意从聊事转向聊重要的人 |

#### 路径 3：时代快照跳转 (Historical Snapshot)

| 属性 | 描述 |
|:---|:---|
| **策略** | 抛出时代标志性事件，询问老人在那个时刻的坐标 |
| **示例** | "咱们聊了不少家常，我突然想到，1997年香港回归那天，您还记得自己在做什么吗？" |
| **产品逻辑** | 适合在某个节点"挖透了"或老人表现出疲劳时，用宏大话题提神 |

#### 路径 4：情感/动机共振跳转 (Affective Association)

| 属性 | 描述 |
|:---|:---|
| **策略** | 抓住老人表达的情绪，引导到另一个具有相同情绪的人生时刻 |
| **示例** | "我能感受到您提起这件事时那股不服输的劲儿。您这一辈子，还有没有哪个时刻，也像这次一样让您觉得自己'绝不认输'？" |
| **产品逻辑** | 打破时间线束缚，通过性格特征串联跨度巨大的事件 |

#### 路径 5："挂起任务"回溯跳转 (Task Resume)

| 属性 | 描述 |
|:---|:---|
| **策略** | 翻出之前被"打断"或"挂起"的话题 |
| **示例** | "刚才咱们聊得太投入，把您小时候在乡下赶集的那段给绕过去了，现在咱们能不能回过头再讲讲那次赶集？" |
| **产品逻辑** | 确保覆盖率（Recall）的硬性保障 |

**跳转优先级**：

| 优先级 | 路径类型 | 理由 |
|:---:|:---|:---|
| **1 (首选)** | 情感/人物路径 | 体验最好，老人感觉被理解 |
| **2 (次选)** | 物理/时序路径 | 逻辑最稳，适合构建回忆录结构 |
| **3 (末选)** | 时代/任务回溯 | 适合对话尴尬或强行补全覆盖率时使用 |

---

### C. 纠偏机制

| 策略 | 动作 |
|:---|:---|
| **矛盾检测** (Conflict Resolution) | 当新的叙事与图谱中已有节点产生逻辑冲突时，触发"澄清动作" |
| **Clarification** | 温和确认："您刚才提到了1980年，但又说是大学前，我稍微有点困惑..." |

---

## 3.5 指令输出层：解耦的指令集

Planner 不直接说话，它输出的是给对话模块的"战术指令"。

### 典型输出格式

| 字段 | 示例内容 | 目的 |
|:---|:---|:---|
| `Current_Focus` | `1992_Startup_Phase` | 锁定当前上下文 |
| `Primary_Action` | `Deep_Dive` / `Breadth_Switch` | 规定动作类型 |
| `Tactical_Goal` | `Extract_Failure_Emotions` | 明确要挖掘的信息点 |
| `Tone_Constraint` | `Empathic_Supportive` | 约束生成模块的语气 |
| `Context_Bridge` | `User_mentioned_Brother_Wang` | 提供衔接用的上下文钩子 |

---

## 3.6 宏观覆盖率逻辑：确保"人生不留白"

Planner 维持全局视图：

| 功能 | 描述 |
|:---|:---|
| **进度计算** | 按预设"人生大纲"实时计算每个区域的挖掘百分比 |
| **动态调整** | 如果某阶段谈太久导致老人疲劳，强行引入"转折点"加速进入下一阶段 |
| **多维完整性校验** | 优秀传记包含时间、空间、人物、情感、反思五个维度 |

**覆盖率公式**：

$$Coverage = \frac{\sum (\text{已挖掘节点} \times \text{深度权重})}{\text{预设大纲总节点数}}$$

---

# 四、动态事件图谱可视化

## 4.1 时间轴森林图（Timeline Forest）

**主视图**：纵向为时间轴（从出生至今），横向为生活领域（家庭、职业、时代大背景、个人爱好）

**节点状态**：
- **高亮节点**：已深度挖掘（槽位填充率 > 80%）
- **半透明节点**：提及但未展开（槽位缺失，Planner 的潜在目标）
- **虚线节点**：预设的大纲节点（待触达）

**连线**：
- 实线：时序关系
- 曲线：因果或逻辑关联（例如：因为"支援边疆"导致了"与爱人两地分居"）

## 4.2 叙事覆盖率仪表盘（Coverage Dashboard）

| 维度 | 展示内容 |
|:---|:---|
| **阶段覆盖** | 童年、青年、中年、晚年的比例分布 |
| **维度覆盖** | 行为（Action）、细节（Details）、情感（Emotions）、反思（Reflections）的达成情况 |
| **信息密度热力图** | 哪些时间段聊得最透彻，哪些是空白 |

## 4.3 实体关联图（Entity Relationship Web）

展示人物、地点、组织之间的网络。中心通常是老人，四周散布着重要人物。

---

# 五、用户体验优化

## 5.1 柔性导航策略

避免像审讯一样提问。当 Planner 决定切换话题时，交互模块应使用"桥接语"：

> "听您说年轻时真不容易，那时候的坚韧确实让人佩服。说到坚韧，我记得您之前提到过……"

## 5.2 节点"断点续传"

老人可能随时中断对话。Planner 需要具备记录"挂起状态"的能力，下次开启时能温故知新。

---

# 六、仿真评估环境

## 6.1 参考框架

- [Agent Role Play 评测机制框架](https://aclanthology.org/2023.emnlp-main.72.pdf)
- [CAMEL-ai](https://www.camel-ai.org/) - 数据生成
- [Anthropic Interviewer 数据集](https://huggingface.co/datasets/Anthropic/AnthropicInterviewer)

## 6.2 评估标准

| 维度 | 评估内容 |
|:---|:---|
| **内容完整度** | 话题覆盖率、事件覆盖率 |
| **问题质量** | 清晰度、相关性、信息量、情绪观点表达、性格价值观体现 |

---

# 七、技术路径与选型

## 7.1 技术思路

采用 **"Schema-on-the-fly"** 思路：预设大框架，动态生长细枝末节。

## 7.2 关键技术选型

### 图谱存储

| 技术方案 | 说明 |
|:---|:---|
| **Neo4j** | 图数据库方案（可选） |
| **JSON-Graph** | 轻量级方案（推荐） |

**节点属性**：ID, 阶段, 核心事件, 挖掘深度(0-5), 关键词, 关联人物

### 信息提取（IE）逻辑

- **LLM-based NER & RE**：每轮对话后，提取 (Subject, Relation, Object)
- **时序对齐**：采用时间轴对齐算法，将凌乱的回忆归位

### LLM 选型

- **主要模型**：混元 / GPT-4
- **评估模型**：GPT-4（用于语义等价性评判）

---

# 八、项目时间规划

## 阶段一：标准定义与 Baseline 搭建 (Week 1)

**目标**：确立"游戏规则"，建立用于对比的纯 LLM 访谈基准

| 任务 | 交付物 |
|:---|:---|
| Planner 指令集标准定义 | JSON 指令协议文档 |
| 访谈规程实例化 | 23 个主题的种子问题库 |
| 评估指标代码化 | 有效轮次、语义等价性计算脚本 |
| 环境准备 | Python 环境、LLM API 接入 |
| Baseline 开发 | 无 Planner 的纯对话 Agent |
| 样本清洗 | User Simulator 的 RAG 向量库 |
| User Simulator 搭建 | 模拟受访者实现 |

## 阶段二：Planner 核心算法开发 (Week 2-4)

**目标**：实现从"对话文本"到"结构化图谱"的映射，并完成导航博弈逻辑

| 周次 | 核心任务 | 关键交付材料 |
|:---|:---|:---|
| **Week 2** | 事件提取与挂载 (MGE) | 1. Event Extractor 模块<br>2. 时序对齐逻辑说明<br>3. 初步生命图谱 (JSON) |
| **Week 3** | 深度扩展路径开发 | 1. 深度导航算法策略代码<br>2. 槽位填充度评分函数<br>3. 深度路径测试 Case 集 |
| **Week 4** | 广度跳转实现 | 1. 广度跳转策略逻辑库<br>2. 疲劳度计分模型<br>3. Planner 决策引擎完整版 |

## 阶段三：可视化呈现与系统集成 (Week 5-6)

**目标**：将后端逻辑可视化，完成解耦架构的链路联调

| 周次 | 核心任务 | 关键交付材料 |
|:---|:---|:---|
| **Week 5** | 动态图谱可视化工具开发 | 1. 可视化前端原型<br>2. 图谱状态同步接口定义 |
| **Week 6** | 系统集成与柔性导航调优 | 1. "叙事导航者"集成系统演示版<br>2. 桥接语生成 Prompt 模版库<br>3. 系统联调测试报告 |

## 阶段四：仿真评估与数据实验 (Week 7-9)

**目标**：运行大规模自动化访谈实验，产出定量与定性的评估报告

| 周次 | 核心任务 | 关键交付材料 |
|:---|:---|:---|
| **Week 7** | 大规模仿真测试 | 1. 自动化测试原始数据库<br>2. Simulator 运行状态监控表 |
| **Week 8** | 评估计算与统计分析 | 1. 多维评估指标计算脚本<br>2. 访谈质量对比原始数据图表 |
| **Week 9** | 主题升华与产品调优 | 1. 主题提炼模块<br>2. 算法性能优化记录文档 |

## 阶段五：结项交付与演示 (Week 10)

**目标**：完善文档，录制视频，完成学术级项目汇报

| 任务 | 交付物 |
|:---|:---|
| 项目终期交付 | 《叙事导航者：技术研究与评估报告》 |
| 系统演示 | 项目演示视频 (Demo Video) |
| 代码整理 | 完整源码仓库 (GitHub/GitLab) |

---

# 九、关键交付物清单

| 类别 | 交付物名称 | 关键特性 |
|:---|:---|:---|
| **算法** | Navigator-Planner API | 接收历史对话，输出 JSON 决策指令 |
| **前端** | Life-Graph Visualizer | 实时展示 23 个主题节点的生长状态 |
| **实验** | Simulation Benchmark | 包含对比数据的 PDF 报告及有效性证明 |
| **内容** | Prompt Library | 包含 23 个主题的种子问题及感官诱导库 |

---

# 十、产品理念与约束

## 10.1 隐私与伦理

| 风险类型 | 处理策略 |
|:---|:---|
| **无内容风险** | 情感引导上的支持 |
| **有内容风险** | 简单回避，重要性靠后由安全部门介入 |

## 10.2 个性化大纲

- 从通用模板（童年、求学、工作、家庭）开始
- 根据老人背景（如知青经历、军旅生涯）进行定制

## 10.3 采访模式

- 支持 Top-down 和 Bottom-up 两种模式
- 根据效果动态调整

---

# 十一、确认的问题与决策

| 问题 | 决策 |
|:---|:---|
| **Planner 是否能用大模型** | 能，"解耦"指规划与 NLG 分离 |
| **输入形式** | 纯文本，自行定义指令集 |
| **情绪感知反馈** | 可在指令集里包含，也可以在对话 agent 里把情绪回应写进固定工作流 |
| **大纲个性化** | 希望有个性化，可以从通用模板开始做 |
| **采访模式** | 自定义，看效果 |
| **内容质量评估标准** | 自定义，看论文 |
| **数据集** | 腾讯那边能给大概两份真实样本 |
| **人生事件图** | 暂时不接入小程序，产出 JSON 即可，可视化优先级靠后 |
